<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <svg width="1200" height="800"></svg>
    <script src="//d3js.org/d3.v3.min.js"></script>

</head>
<body>
    <script>
     
        const svg = d3.select('svg');
           //           svg.attr('height', height)
           //           svg.attr('width', width);
        const width = +svg.attr('width');
        const height = +svg.attr('height');
        const margin = { top:20, left:20,bottom:20,right:20 }
        console.log('h ', height)
        console.log('w ', width)

        const scalePositive = (item,axis) => {
            if (axis === 'x') {
                if (item.x < 0) {
                    item.x *= -1
                    console.log('received an item.x in ' + item.x)
                    return item.x
                } else if (item.x > 0) {
                    return item.x
                } else {
                    return item.x
                }
            }
            if (axis === 'y') {
                if (item.y < 0) {
                    item.y *= -1
                    console.log('received an item.y in ' + item.y)
                    return item.y
                } else if (item.y > 0) {
                    return item.y
                } else { return item.y }
                return item.x ? item.x : item.y
            }
        }
        let xScale,yScale = 0
        const defineScales = (scaleData) => {
            xScale = d3.scaleLinear()
                .domain([0, d3.max(scaleData, d => scalePositive(d,'x')) ]) 
                .range([0, width]);

           console.log('xScaleDomain begin')
            console.log(xScale.domain())
            console.log('xScale  end')

            yScale = d3.scaleLinear()
                .domain([0, d3.max(scaleData,d => scalePositive(d,'y'))])
                .range([0, height])
            console.log('yScaleDomain begin')
            console.log(yScale.domain())
            console.log('yScale  end')
        }
  
       

        d3.csv("cities.csv")
            .then(d => {
                d.forEach(data => {
                });
                defineScales(d)
            const createCircles = (circleData) => {
            rootCircle = circleData.slice(0,1)
            console.log('-----------')
            console.log(rootCircle)
                console.log('----------')
           const mainCircleGrp = svg.append('g')
                        .attr('transform', `translate(${ margin.left },${margin.top })`);

            mainCircleGrp.selectAll("circle")
                .data(rootCircle)
                   .enter()
                .append('circle')
                .attr("cx", (d) => xScale(scalePositive(d,'x'))/4)
                .attr("cy", (d) => d.y)
                     .attr("r", (r) => Math.sqrt(r.x**2))
                .style("fill", "red")
                .on('click',createChildCircles)

            }
                const createChildCircles = () => {
                const circleG = svg.append('g')
                        .attr('transform', `translate(${ margin.left },${margin.top })`);

                    circleG.selectAll("circle")
                        .data(d)
                        .enter()
                        .append('circle')
                        .attr("cx", (d) => xScale(scalePositive(d,'x')))
                        .attr("cy", (d) => yScale(scalePositive(d,'y')))
                        .attr("r", (r) => Math.sqrt(r.x ** 2))
                        .style("fill", "green")
                }


            createCircles(d)

            });


    </script>
</body>
</html>